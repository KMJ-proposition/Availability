# PowerShell 101
* [PowerShell 101 - Mike F. Robbins](https://learn.microsoft.com/ko-kr/powershell/scripting/learn/ps101/01-getting-started?view=powershell-7.5)

## ㄱ. 개요
* PowerShell
    > Windows 11은 64비트 운영 체제로만 제공됩니다. Windows 11에는 32비트 버전이 없습니다. 그러나 Windows 11에는 32비트 버전의 Windows PowerShell 및 Windows PowerShell ISE가 포함되어 있습니다.
    
    > UAC는 악성 코드가 상승된 권한으로 실행되지 않도록 하는 Windows 보안 기능입니다.
    
    > PowerShell 버전 7은 Windows PowerShell 5.1의 대체 버전이 아닙니다.
    
    > ! Important
        >> 2017년에 게시된 이 책의 원래 버전은 PowerShell을 시작할 때마다 자동으로 관리자 권한 인스턴스를 시작하도록 작업 표시줄에 바로 가기를 고정하는 것이 좋습니다. 그러나 잠재적인 보안 문제로 인해 더 이상 권장하지 않습니다. 또한 PowerShell의 관리자 권한 인스턴스에서 시작하는 모든 애플리케이션은 UAC를 우회하고 관리자 권한으로 실행됩니다. 예를 들어 PowerShell의 관리자 권한 인스턴스에서 웹 브라우저를 시작하는 경우 악성 코드가 포함된 웹 사이트도 관리자 권한으로 실행됩니다.
        
## 1장 - 02. PowerShell 시작
* PowerShell의 기본 명령

### 학습 목표
1. PowerShell의 기본 명령을 익힌다.
2. PowerShell을 이해하는 감각을 익힌다.
3. CLI에 대한 이해를 높인다.
4. Windows에 대한 감각을 높인다.
5. 커널과 드라이버에 대해 호기심을 갖고 탐구하는 자세를 갖는다.

### 특징
* PowerShell에서 명령은 명령어가 아니다.
* PowerShell은 텍스트 출력이 아닌 객체를 반환한다.
* 반드시 필요한 경우에만 관리자 권한으로 실행해야 한다.
    - PowerShell에는 리눅스 셸의 root 또는 그와 비슷한 명령어가 없다.
    - 관리자 권한은 실행 정책과 다르다.
    - 즉, CLI를 통한 시스템 총괄이 불가능하다.
        + 이로써 커널이 Windows 운영체제를 지배함을 알 수 있다.
* Windows 운영체제는 Win32 API로 커널에게 프로세스 사용 권한을 요청하는 구조이다. 
```
.NET:
  Microsoft에서 만든 '애플리케이션 개발 프레임워크'이다.
  주요 기능은 운영체제의 기능을 안전하고 일관된 방식으로 사용할 수 있도록 API를 제공하는 것이다.
  또한 과거엔 Windows 전용이었으나, 현재는 Windows/Linux/MacOS를 지원한다.
PowerShell:
  PowerShell은 명령의 실행 결과를 문자열이 아닌 '객체 단위'로 반환한다.
  CLI와 달리 텍스트 기반 표준 출력이 아니다.
  때문에 PowerShell 만의 구조화된 '속성'으로 정보를 다룰 수 있다.
```

#### 주요 명령
* $PSVersionTable
    - 파워셸 버전 출력
* Stop-Service
    - 서비스 정지
* Get-ExecutionPolicy
    - 스크립트 실행 정책 확인
* Set-ExecutionPolicy
    - 스크립트 실행 정책을 변경해 실행 허용 범위를 제어하는 보안 기능이다.
* Get-Service
    - 서비스 상태 확인
* Get-TimeZone
    - 현재 시스템 시간대 확인
* Select-Object
    - 명령의 결과를 파이프라인으로 전달받은 객체에서 원하는 속성을 추출한다.
    - 이를 새로운 객체로 반환한다.
* echo
    - 문자열 출력
    - 'Write-Output'과 동일
* \[System.Environment\]\:\:
    - .NET 클래스의 정적 멤버에 접근, 시스템 정보에 접근 가능한 명령
* \[Environment\]\:\:
    - 위와 동일
* {}
    - 스크립트 블록
* \$\$
    - 바로 이전 명령 실행
* \$?
    - 이전 명령의 실행 성공 여부\[ True \| False \]

***

## ㄴ. 본문
### $PSVersionTable
* PowerShell 버전 확인
    ```PowerShell
    PS> $PSVersionTable

    Name                           Value
    ----                           -----
    PSVersion                      5.1.26100.7705
    PSEdition                      Desktop
    PSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}
    BuildVersion                   10.0.26100.7705
    CLRVersion                     4.0.30319.42000
    WSManStackVersion              3.0
    PSRemotingProtocolVersion      2.3
    SerializationVersion           1.1.0.1
    ```
    
---

### Get-ExecutionPolicy
* 이 명령은 스크립트에 대한 실행 정책이다.
* 실행 정책 확인
    ```PowerShell
    PS> Get-ExecutionPolicy

    Restricted
    ```
* 실행 정책 목록
    ```PowerShell
            Scope ExecutionPolicy
            ----- ---------------
    MachinePolicy       Undefined
       UserPolicy       Undefined
          Process       Undefined
      CurrentUser       Undefined
     LocalMachine       Undefined
    ```

---

### Set-ExecutionPolicy
* 실행 정책 변경
    - 관리자 권한의 PowerShell에서 실행하여야 권한 정책이 바뀐다.
        ```PowerShell
        PS> Set-ExecutionPolicy -ExecutionPolicy RemoteSigned

        실행 규칙 변경
        실행 정책은 신뢰하지 않는 스크립트로부터 사용자를 보호합니다. 실행 정책을 변경하면 about_Execution_Policies 도움말
        항목(https://go.microsoft.com/fwlink/?LinkID=135170)에 설명된 보안 위험에 노출될 수 있습니다. 실행 정책을
        변경하시겠습니까?
        [Y] 예(Y)  [A] 모두 예(A)  [N] 아니요(N)  [L] 모두 아니요(L)  [S] 일시 중단(S)  [?] 도움말 (기본값은 "N"): y
        ```
    - 사용자를 특정해 변경할 수 있다.
        ```PowerShell
        PS> Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser

        실행 규칙 변경
        실행 정책은 신뢰하지 않는 스크립트로부터 사용자를 보호합니다. 실행 정책을 변경하면 about_Execution_Policies 도움말
        항목(https://go.microsoft.com/fwlink/?LinkID=135170)에 설명된 보안 위험에 노출될 수 있습니다. 실행 정책을
        변경하시겠습니까?
        [Y] 예(Y)  [A] 모두 예(A)  [N] 아니요(N)  [L] 모두 아니요(L)  [S] 일시 중단(S)  [?] 도움말 (기본값은 "N"): y
        ```
* 실행 정책 목록
    - 재확인하면 바뀐 것을 알 수 있다.
        ```PowerShell
        PS> Get-ExecutionPolicy -List

                Scope ExecutionPolicy
                ----- ---------------
        MachinePolicy       Undefined
           UserPolicy       Undefined
              Process       Undefined
          CurrentUser    RemoteSigned
         LocalMachine    RemoteSigned
        ```
* 스크립트 파일 실행
    - 스크립트 실행 정책을 완화하였기에 실행 가능하다.
    ```PowerShell
    PS> & { @\"
    >> echo 이것은 스크립트 파일입니다.
    >> [system.environment]::NewLine
    >> Get-Service -Name W32Time
    >> \"@ } > PowerShell101_02.ps1
    PS> .\PowerShell101_02.ps1
    이것은
    스크립트
    파일입니다.



    Status   Name               DisplayName
    ------   ----               -----------
    Running  W32Time            Windows Time
    ```
* 보안 설정 도움말
    - [Microsoft-Learning](https://learn.microsoft.com/ko-kr/powershell/scripting/learn/ps101/01-getting-started?view=powershell-7.5)

---

### [Start|Stop|Get]-Service
* Get-Service
    ```PowerShell
        PS> Get-Service -Name W32Time

        Status   Name               DisplayName
        ------   ----               -----------
        Running  W32Time            Windows Time
        ```
* Stop-Service
    ```PowerShell
    PS> Stop-Service -Name W32Time
    PS> Get-Service -Name W32Time

    Status   Name               DisplayName
    ------   ----               -----------
    Stopped  W32Time            Windows Time
    ```
* Start-Service
    ```PowerShell
    PS> Start-Service -Name W32Time
    PS> Get-Service -Name W32Time

    Status   Name               DisplayName
    ------   ----               -----------
    Running  W32Time            Windows Time
    ```

***

## ㄷ. 실행 기록
* History
    ```PowerShell
    PS> history

    Id CommandLine
    -- -----------
     1 $PSVersionTable
     2 Get-ExecutionPolicy
     3 Get-ExecutionPolicy -List
     4 Stop-Service -Name W32Time
     5 Get-Service -Name W32Time
     6 Start-Service -Name W32Time
     7 Get-Service -Name W32Time
     8 & { @"...
     9 .\PowerShell101_02.ps1
    10 Get-ExecutionPolicy -List
    11 Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
    12 .\PowerShell101_02.ps1
    13 & { @"...
    14 .\PowerShell101_02.ps1
    ```